<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>í•™ë¶€ëª¨ ì •ë³´ ì…ë ¥</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .form-container {
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    .form-title {
      margin-bottom: 30px;
      padding-bottom: 10px;
      border-bottom: 2px solid #0d6efd;
    }
    .required-mark {
      color: red;
      margin-left: 3px;
    }
    .form-section {
      background-color: #f8f9fa;
      padding: 20px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .optional-text {
      color: #6c757d;
      font-size: 0.875rem;
      margin-left: 5px;
    }

    .registration-guide {
      background-color: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      border-left: 4px solid #0d6efd;
    }
    .registration-guide h3 {
      color: #0d6efd;
      margin-bottom: 15px;
      font-size: 1.3rem;
    }
    .registration-guide p {
      color: #6c757d;
      margin-bottom: 10px;
      line-height: 1.6;
    }
    .registration-guide ul {
      padding-left: 20px;
      margin-bottom: 0;
    }
    .registration-guide li {
      color: #495057;
      margin-bottom: 8px;
      line-height: 1.5;
    }
    .required {
      color: #dc3545;
      margin-left: 3px;
    }
    .guide-section {
      margin-bottom: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 8px;
    }
    .guide-subtitle {
      color: #0d6efd;
      margin-bottom: 10px;
    }
    .guide-content ul {
      padding-left: 20px;
    }
    .guide-content li {
      margin-bottom: 8px;
    }
    .input-group .form-control {
      text-align: center;
    }
    .input-group .input-group-text {
      background-color: #f8f9fa;
    }
  </style>
</head>
<body>
<div class="form-container">
  <h2 class="form-title">í•™ë¶€ëª¨ ì •ë³´ ì…ë ¥</h2>
  <!-- ê°€ì´ë“œ ë²„íŠ¼ ì¶”ê°€ -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#guideModal">
      <i class="bi bi-question-circle"></i> ğŸ“Œì™œ ì´ëŸ° ì •ë³´ë¥¼ ì…ë ¥í•´ì•¼ í•˜ë‚˜ìš”?
    </button>
  </div>

  <!-- ê°€ì´ë“œ ëª¨ë‹¬ -->
  <div class="modal fade" id="guideModal" tabindex="-1" aria-labelledby="guideModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="guideModalLabel">ğŸ“‹ í•™ë¶€ëª¨ ë“±ë¡ ê°€ì´ë“œ</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="guide-content">
            <div class="guide-section">
              <h6 class="guide-subtitle">ğŸ’¡ ì‹œìŠ¤í…œ ì„¤ëª… ì•ˆë‚´</h6>
              <p>ERP ì‹œìŠ¤í…œì—ì„œ ì§ì›(ì›ì¥, êµì‚¬)ì´(ê°€) í•™ë¶€ëª¨ ë“±ë¡í•˜ê¸°ë¥¼ ì…ë ¥í•˜ëŠ” ê³¼ì •ì´ ìˆìŠµë‹ˆë‹¤. </p>
              <p>ì•ì„œ ì‘ì„±í•œ <strong>ì•½ê´€, ë™ì˜ì„œ</strong>ì™€ ë¡œê·¸ì¸ ì‹œ ì‚¬ìš©í•  <strong>ì´ë©”ì¼</strong>ê³¼ <strong>ì…ë ¥í•˜ì‹  ì •ë³´</strong>ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë“±ë¡ í›„ </p>
              <p>ì´ë©”ì¼ê³¼ ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ í†µë³´ í›„ í•´ë‹¹ ê³„ì •ìœ¼ë¡œ ìµœì´ˆ ë¡œê·¸ì¸ ì‹œ <strong>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í˜ì´ì§€</strong>ë¡œ ì•ˆë‚´í•´ ë“œë¦¬ê³  ìˆìŠµë‹ˆë‹¤.</p>
            </div>

            <div class="guide-section">
              <h6 class="guide-subtitle">ğŸ” ì…ë ¥ ì •ë³´ ì•ˆë‚´</h6>
              <p>ì•„ë˜ ì–‘ì‹ì„ í†µí•´ í•™ë¶€ëª¨ì˜ ê¸°ë³¸ ì •ë³´ë¥¼ ë“±ë¡í•˜ì„¸ìš”.</p>
              <p>ìœ ì¹˜ì›ê³¼ì˜ ì›í™œí•œ ì†Œí†µ ë° ì‹œìŠ¤í…œ ê´€ë¦¬ë¥¼ ìœ„í•´ í•„ìš”í•œ ì •ë³´ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            </div>

            <div class="guide-section">
              <h6 class="guide-subtitle">âœ… í•„ìˆ˜ ì…ë ¥ ì‚¬í•­</h6>
              <ul>
                <li>ì´ë©”ì¼ (ë¡œê·¸ì¸ ì‹œ ì‚¬ìš©)</li>
                <li>ì„±í•¨</li>
                <li>íœ´ëŒ€í° ë²ˆí˜¸</li>
                <li>ì£¼ì†Œ</li>
                <li>ìƒì„¸ì£¼ì†Œ</li>
              </ul>
            </div>

            <div class="guide-section">
              <h6 class="guide-subtitle">ğŸ”’ ê°œì¸ì •ë³´ ë³´í˜¸</h6>
              <ul>
                <li>ì…ë ¥ëœ ì •ë³´ëŠ” <strong>ìœ ì¹˜ì› ë° ì–´ë¦°ì´ì§‘ ì‹œìŠ¤í…œì—ì„œë§Œ</strong> ì‚¬ìš©ë˜ë©°, <strong>ì•ˆì „í•˜ê²Œ ë³´í˜¸ë©ë‹ˆë‹¤.</strong></li>
                <li>ì…ë ¥ëœ ì •ë³´ëŠ” í•™ë¶€ëª¨ ì „ìš© ì‹œìŠ¤í…œ(ê°œë°œ ì˜ˆì •)ì—ì„œ í™•ì¸ ê°€ëŠ¥í•˜ë©°, ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                <li>ë“±ë¡ í›„, í•™ë¶€ëª¨ ì „ìš© ì‹œìŠ¤í…œì—ì„œ ì°¾ê¸° ì‰½ë„ë¡ ê´€ë¦¬ë©ë‹ˆë‹¤.</li>
                <li><strong>ê°œì¸ì •ë³´ ë³´í˜¸ ë° ì˜ˆë°© êµìœ¡ì„ ì›ë‚´ ì§ì›ë“¤ì—ê²Œ ì£¼ê¸°ì ìœ¼ë¡œ êµìœ¡ì„ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.</strong></li>
              </ul>
            </div>

            <div class="guide-section">
              <h6 class="guide-subtitle">ğŸ›¡ï¸ ê°œì¸ì •ë³´ ë³´í˜¸ ë° ê´€ë¦¬ ì•ˆë‚´</h6>
              <ul>
                <li>ê°œì¸ì •ë³´ ë³´ì¡´ ê¸°ê°„ : ë“±ë¡ëœ í•™ë¶€ëª¨ì˜ ì •ë³´ëŠ” ë²•ë ¹ì— ë”°ë¼ ìµœëŒ€ 5ë…„ê°„ ë³´ì¡´ë˜ë©°, ë³´ì¡´ ê¸°ê°„ ì¢…ë£Œ í›„ ì•ˆì „í•˜ê²Œ íŒŒê¸° ë©ë‹ˆë‹¤.</li>
                <li>íŒŒê¸° ì ˆì°¨ ë° ë°©ë²• : ê°œì¸ì •ë³´ëŠ” ì „ì íŒŒì¼ í˜•íƒœì˜ ê²½ìš° ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ë°©ë²•ìœ¼ë¡œ ì‚­ì œí•˜ë©°, ë¬¸ì„œ í˜•íƒœëŠ” ë¶„ì‡„ ë˜ëŠ” ì†Œê° ì²˜ë¦¬ í•©ë‹ˆë‹¤.</li>
                <li>ì •ë³´ ìˆ˜ì • ë° ì‚­ì œ ìš”ì²­ : í•™ë¶€ëª¨ì˜ ì •ë³´ìˆ˜ì •, ì‚­ì œë¥¼ ì›í•˜ì‹œëŠ” ê²½ìš° ì‹œìŠ¤í…œ ë‚´ [ë§ˆì´í˜ì´ì§€] ë˜ëŠ” ì§ì›, ì›ì¥ì—ê²Œ ë¬¸ì˜í•˜ì‹œë©´ ì‹ ì†íˆ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
                <li>ê°œì¸ì •ë³´ ë³´í˜¸ ëŒ€ì±… : ë³¸ ì‹œìŠ¤í…œì€ ì •ê¸° ë³´ì•ˆ ì ê²€, ë³´ì•ˆ ê¸°ìˆ  ëŒ€ì±… ê°•êµ¬ ë“± ê°œì¸ì •ë³´ ìœ ì¶œ ë°©ì§€ì— ìµœì„ ì„ ë‹¤í•˜ê³  ìˆìŠµë‹ˆë‹¤.</li>
              </ul>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
  </div>

  <form id="parentInfoForm" th:action="@{/consent/register-parent}" th:object="${parentInfo}" method="post">
    <!-- ë¡œê·¸ì¸ ì •ë³´ ì„¹ì…˜ -->
    <div class="form-section">
      <h4 class="mb-4">ë¡œê·¸ì¸ ì •ë³´</h4>
      <div class="form-group">
        <label for="email">ì´ë©”ì¼<span class="required-mark">*</span></label>
        <div class="input-group">
          <input type="email" class="form-control" id="email" th:field="*{email}" required>
          <div class="alert alert-danger" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
          <button type="button" class="btn btn-outline-primary" onclick="checkEmailDuplicate()">ì¤‘ë³µí™•ì¸</button>
        </div>
        <div class="form-text" id="emailHelp">ë¡œê·¸ì¸ ì‹œ ì‚¬ìš©í•  ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
      </div>
    </div>

    <!-- ê°œì¸ì •ë³´ ì„¹ì…˜ -->
    <div class="form-section">
      <h4 class="mb-4">í•™ë¶€ëª¨ ê°œì¸ì •ë³´</h4>
      <div class="form-group">
        <label for="name">ì„±í•¨<span class="required-mark">*</span></label>
        <input type="text" class="form-control" id="name" th:field="*{name}" required>
        <div class="alert alert-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
      </div>

      <div class="form-group">
        <label>ì—°ë½ì²˜<span class="required-mark">*</span></label>
        <div class="input-group">
          <select class="form-select" id="phone1" style="max-width: 100px;">
            <option value="010">010</option>
            <option value="011">011</option>
            <option value="016">016</option>
            <option value="017">017</option>
            <option value="018">018</option>
            <option value="019">019</option>
          </select>
          <span class="input-group-text">-</span>
          <input type="text" class="form-control" id="phone2" maxlength="4">
          <span class="input-group-text">-</span>
          <input type="text" class="form-control" id="phone3" maxlength="4">
        </div>
        <input type="hidden" th:field="*{phone}" id="phone">
      </div>

      <div class="form-group">
        <label>ë¹„ìƒì—°ë½ì²˜<span class="optional-text">(ì„ íƒì‚¬í•­)</span></label>
        <div class="input-group">
          <select class="form-select" id="emergency1" style="max-width: 100px;">
            <option value="010">010</option>
            <option value="011">011</option>
            <option value="016">016</option>
            <option value="017">017</option>
            <option value="018">018</option>
            <option value="019">019</option>
          </select>
          <span class="input-group-text">-</span>
          <input type="text" class="form-control" id="emergency2" maxlength="4">
          <span class="input-group-text">-</span>
          <input type="text" class="form-control" id="emergency3" maxlength="4">
          <input type="hidden" name="childrenEmergencyPhone" id="childrenEmergencyPhone">
        </div>
        <div class="form-text">ë¹„ìƒì‹œ ì—°ë½ ê°€ëŠ¥í•œ ë‹¤ë¥¸ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
      </div>

      <div class="form-group">
        <label>ì£¼ì†Œ<span class="required-mark">*</span></label>
        <div class="input-group mb-2">
          <input type="text" class="form-control" id="postcode" placeholder="ìš°í¸ë²ˆí˜¸" readonly>
          <button type="button" class="btn btn-outline-primary" onclick="searchAddress()">ì£¼ì†Œ ê²€ìƒ‰</button>
        </div>
        <input type="hidden" th:field="*{address}" id="address">
        <input type="text" class="form-control mb-2" id="addressDisplay" placeholder="ê¸°ë³¸ì£¼ì†Œ" readonly>
        <input type="text" class="form-control" th:field="*{detailAddress}" placeholder="ìƒì„¸ì£¼ì†Œ">
      </div>
    </div>

    <!-- ë²„íŠ¼ ê·¸ë£¹ -->
    <div class="d-flex justify-content-between mt-4">
      <button type="button" class="btn btn-secondary" onclick="history.back()">ì´ì „</button>
      <button type="submit" class="btn btn-primary" onclick="return validateAndSubmit()">ê°€ì… ì™„ë£Œ</button>
    </div>

  </form>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Daum ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
  // ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸
  function checkEmailDuplicate() {
    const email = document.getElementById('email').value;
    const emailHelp = document.getElementById('emailHelp');
    const emailInput = document.getElementById('email');

    // ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      alert('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
      return;
    }

    // AJAX ìš”ì²­
    fetch(`/consent/check-email?email=${encodeURIComponent(email)}`)
            .then(response => response.json())
            .then(data => {
              if (data.isDuplicate) {
                emailHelp.textContent = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                emailHelp.className = 'form-text text-danger';
                emailInput.classList.add('is-invalid');
              } else {
                emailHelp.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                emailHelp.className = 'form-text text-success';
                emailInput.classList.add('is-valid');
                emailInput.classList.remove('is-invalid');
              }
            })
            .catch(error => {
              console.error('Error:', error);
              emailHelp.textContent = 'ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
              emailHelp.className = 'form-text text-danger';
            });
  }

  // ì£¼ì†Œ ê²€ìƒ‰
  function searchAddress() {
    new daum.Postcode({
      oncomplete: function(data) {
        document.getElementById('postcode').value = data.zonecode;
        document.getElementById('addressDisplay').value = data.address;
        document.getElementById('address').value = data.address;
        document.getElementById('detailAddress').focus();
      }
    }).open();
  }

  // ìˆ«ìë§Œ ì…ë ¥ í—ˆìš©
  function onlyNumber(event) {
    event.target.value = event.target.value.replace(/[^0-9]/g, '');
  }

  // í¼ ì œì¶œ ì „ ìœ íš¨ì„± ê²€ì‚¬ ë° ë°ì´í„° ì²˜ë¦¬
  function validateAndSubmit() {
    // ì „í™”ë²ˆí˜¸ ì¡°í•©
    const phone1 = document.getElementById('phone1').value;
    const phone2 = document.getElementById('phone2').value;
    const phone3 = document.getElementById('phone3').value;

    if (!phone2 || !phone3) {
      alert('ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return false;
    }

    const phoneNumber = `${phone1}-${phone2}-${phone3}`;
    const phoneRegex = /^01(?:0|1|[6-9])-(?:\d{3}|\d{4})-\d{4}$/;

    if (!phoneRegex.test(phoneNumber)) {
      alert('ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
      return false;
    }

    // hidden í•„ë“œì— ì „í™”ë²ˆí˜¸ ì„¤ì •
    document.getElementById('phone').value = phoneNumber;

    // ì£¼ì†Œ ê²€ì¦
    const addressDisplay = document.getElementById('addressDisplay').value;
    if (!addressDisplay) {
      alert('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return false;
    }

    // hidden í•„ë“œì— ì£¼ì†Œ ì„¤ì •
    document.getElementById('address').value = addressDisplay;

    // ë¹„ìƒì—°ë½ì²˜ ì²˜ë¦¬ (ì„ íƒì‚¬í•­)
    const emergency1 = document.getElementById('emergency1').value;
    const emergency2 = document.getElementById('emergency2').value;
    const emergency3 = document.getElementById('emergency3').value;

    if (emergency2 && emergency3) {
      const emergencyPhone = `${emergency1}-${emergency2}-${emergency3}`;
      document.getElementById('childrenEmergencyPhone').value = emergencyPhone;
    }

    return true;
  }

  // ìë™ í¬ì»¤ìŠ¤ ì´ë™ ì„¤ì •
  function setupAutoFocus(input, nextId) {
    input.addEventListener('input', function() {
      if (this.value.length >= this.maxLength) {
        const next = document.getElementById(nextId);
        if (next) next.focus();
      }
    });
  }

  // ìˆ«ìë§Œ ì…ë ¥ë˜ë„ë¡ ì²˜ë¦¬
  function setupNumberOnly(inputId) {
    const input = document.getElementById(inputId);
    if (input) {
      input.addEventListener('input', function() {
        this.value = this.value.replace(/[^0-9]/g, '');
      });
    }
  }

  // ì´ˆê¸° ì„¤ì •
  document.addEventListener('DOMContentLoaded', function() {
    // ì „í™”ë²ˆí˜¸ ì…ë ¥ í•„ë“œì— ìˆ«ìë§Œ ì…ë ¥ë˜ë„ë¡ ì„¤ì •
    const numberInputs = ['phone2', 'phone3', 'emergency2', 'emergency3'];
    numberInputs.forEach(id => {
      const input = document.getElementById(id);
      if (input) {
        input.addEventListener('input', onlyNumber);
      }
    });

    // ìë™ í¬ì»¤ìŠ¤ ì´ë™
    document.getElementById('phone2')?.addEventListener('input', function() {
      if (this.value.length === 4) {
        document.getElementById('phone3')?.focus();
      }
    });

    document.getElementById('emergency2')?.addEventListener('input', function() {
      if (this.value.length === 4) {
        document.getElementById('emergency3')?.focus();
      }
    });
  });
</script>
</body>
</html>