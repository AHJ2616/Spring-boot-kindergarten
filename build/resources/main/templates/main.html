<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layout2}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>킨더브릿지 유치원</title>

  <!-- Bootstrap CSS & JS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
</head>
<body th:data-user-logged-in="${#authorization.expression('isAuthenticated()')}">
<div layout:fragment="content">
    <div class="main-container">
   <!-- 가입신청 버튼 -->
   <div class="join-image-container">
    <img th:src="@{/image/join1.png}"
            onclick="location.href='/employee/new'" 
            alt="원아 등록신청" 
            class="join-image" 
            style="cursor: pointer;">
            <span>입학 신청</span>
   </div>
        <!-- 공지사항 섹션 -->
        <div class="section notice-section">
            <a href="/board/list/notification">
            <h2 class="mb-4">공지사항</h2>
        </a>
            <ul class="notice-list">
                <li class="notice-item" th:each="notice : ${notices}">
                    <div class="d-flex justify-content-between align-items-center">
                        <a th:href="@{/board/get/{id}(id=${notice.boardId})}" 
                           class="text-decoration-none text-dark">
                            <span th:text="${notice.boardTitle}">공지사항 제목</span>
                            <span th:if="${notice.boardType == T(com.kinder.kindergarten.constant.board.BoardType).ABSOLUTE}" 
                                  class="badge bg-danger ms-2">중요</span>
                        </a>
                        <small class="text-muted" 
                               th:text="${#temporals.format(notice.regiDate, 'yyyy-MM-dd')}">
                            날짜
                        </small>
                    </div>
                </li>
            </ul>
        </div>

     
    </div>
     <!-- Scripts -->
  <script src="/js/main.js" defer></script>
  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-messaging.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDx50lPQcrTE99PgDWFJpuwgqBUdWrGi-U",
        authDomain: "kinder-60299.firebaseapp.com",
        projectId: "kinder-60299",
        storageBucket: "kinder-60299.firebasestorage.app",
        messagingSenderId: "140409399819",
        appId: "1:140409399819:web:2b61374c56f111f22eb50e",
        measurementId: "G-FQPT683TX8"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const messaging = getMessaging(app);

    // 서비스 워커 등록
    async function registerServiceWorker() {
        try {
            if ('serviceWorker' in navigator) {
                const registration = await navigator.serviceWorker.register('/firebase-messaging-sw.js');
                console.log('서비스 워커가 등록되었습니다:', registration);
                return registration;
            }
            throw new Error('서비스 워커를 지원하지 않는 브라우저입니다.');
        } catch (error) {
            console.error('서비스 워커 등록 실패:', error);
            throw error;
        }
    }

    // Export functions for global use
    window.firebaseApp = app;
    window.firebaseMessaging = messaging;
    window.firebaseOnMessage = onMessage;
    window.getFirebaseToken = async () => {
        try {
            await registerServiceWorker();
            // Firebase 콘솔에서 생성한 실제 VAPID 키로 교체
            const currentToken = await getToken(messaging, {
                vapidKey: "BPVvFKCqaKWsqmHWqPEnqnKU_ZuTLIjO2thHKGvXY8pXNPR9_c8bXwQXw5QwGe9bAX0WQ4_k_7n3rbEE_1p4Ric",
                serviceWorkerRegistration: await navigator.serviceWorker.getRegistration()
            });
            console.log('FCM 토큰:', currentToken);
            return currentToken;
        } catch (error) {
            console.error('토큰을 가져오는데 실패했습니다:', error);
            return null;
        }
    };
  </script>
  <!-- 커스텀 Firebase 메시징 스크립트 -->
  <script src="/js/board/firebaseMessaging.js" defer></script>
</div>
</body>
</html>